{% extends "_base.html" %}
{% block title %}My Exam Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-3">Welcome, {{ profile.user.first_name|default:profile.user.username }}</h2>

  {% if error %}
    <div class="alert alert-warning mt-3">
      {{ error }}
    </div>
    <p class="text-muted">Once your manager assigns you a job, your required exams will appear here.</p>
  {% else %}
    <h5>Job: {{ primary_job.title }}</h5>

    <div class="row mt-4 text-center">
      <div class="col-md-3"><div class="card"><div class="card-body"><h6>Total Exams</h6><h2>{{ total_exams }}</h2></div></div></div>
      <div class="col-md-3"><div class="card"><div class="card-body"><h6>Taken</h6><h2>{{ taken_count }}</h2></div></div></div>
      <div class="col-md-3"><div class="card"><div class="card-body"><h6>Passed</h6><h2 class="text-success">{{ passed_count }}</h2></div></div></div>
      <div class="col-md-3"><div class="card"><div class="card-body"><h6>Failed</h6><h2 class="text-danger">{{ failed_count }}</h2></div></div></div>
    </div>

    <hr>

    <h4>Failed Exams (Retake Available)</h4>
    <ul class="list-group mb-4">
      {% for exam in failed_exams %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ exam.title }} ({{ exam.get_season_display }} {{ exam.year }})
          <a href="{% url 'exam_detail' exam.pk %}" class="btn btn-sm btn-warning">Retake</a>
        </li>
      {% empty %}
        <li class="list-group-item text-center text-muted">No failed exams </li>
      {% endfor %}
    </ul>

    <h4>Remaining Exams</h4>
    <ul class="list-group">
      {% for exam in remaining_exams %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ exam.title }} ({{ exam.get_season_display }} {{ exam.year }})
          <a href="{% url 'exam_detail' exam.pk %}" class="btn btn-sm btn-primary">Take Exam</a>
        </li>
      {% empty %}
        <li class="list-group-item text-center text-muted">All exams completed</li>
      {% endfor %}
    </ul>
  {% endif %}
</div>
{% endblock %}

